{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\gitzip\\\\ReactwebHashcampus\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\gitzip\\\\ReactwebHashcampus\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"D:\\\\gitzip\\\\ReactwebHashcampus\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"D:\\\\gitzip\\\\ReactwebHashcampus\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:\\\\gitzip\\\\ReactwebHashcampus\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import{useSelector,useDispatch}from'react-redux';import{Link}from'react-router-dom';import{isLength,isMatch}from'../../utils/validation/Validation';import{showSuccessMsg,showErrMsg}from'../../utils/notification/Notification';import{fetchAllUsers,dispatchGetAllUsers}from'../../../redux/actions/usersAction';var initialState={name:'',password:'',cf_password:'',err:'',success:''};function Profile(){var auth=useSelector(function(state){return state.auth;});var token=useSelector(function(state){return state.token;});var users=useSelector(function(state){return state.users;});var user=auth.user,isAdmin=auth.isAdmin;var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var name=data.name,password=data.password,cf_password=data.cf_password,err=data.err,success=data.success;var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),avatar=_useState4[0],setAvatar=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),callback=_useState8[0],setCallback=_useState8[1];var dispatch=useDispatch();useEffect(function(){if(isAdmin){fetchAllUsers(token).then(function(res){dispatch(dispatchGetAllUsers(res));});}},[token,isAdmin,dispatch,callback]);var handleChange=function handleChange(e){var _objectSpread2;var _e$target=e.target,name=_e$target.name,value=_e$target.value;setData(_objectSpread(_objectSpread({},data),{},(_objectSpread2={},_defineProperty(_objectSpread2,name,value),_defineProperty(_objectSpread2,\"err\",''),_defineProperty(_objectSpread2,\"success\",''),_objectSpread2)));};var changeAvatar=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;file=e.target.files[0];if(file){_context.next=5;break;}return _context.abrupt(\"return\",setData(_objectSpread(_objectSpread({},data),{},{err:\"No files were uploaded.\",success:''})));case 5:if(!(file.size>1024*1024)){_context.next=7;break;}return _context.abrupt(\"return\",setData(_objectSpread(_objectSpread({},data),{},{err:\"Size too large.\",success:''})));case 7:if(!(file.type!=='image/jpeg'&&file.type!=='image/png')){_context.next=9;break;}return _context.abrupt(\"return\",setData(_objectSpread(_objectSpread({},data),{},{err:\"File format is incorrect.\",success:''})));case 9:formData=new FormData();formData.append('file',file);setLoading(true);_context.next=14;return axios.post('/api/upload_avatar',formData,{headers:{'content-type':'multipart/form-data',Authorization:token}});case 14:res=_context.sent;setLoading(false);setAvatar(res.data.url);_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](1);setData(_objectSpread(_objectSpread({},data),{},{err:_context.t0.response.data.msg,success:''}));case 22:case\"end\":return _context.stop();}}},_callee,null,[[1,19]]);}));return function changeAvatar(_x){return _ref.apply(this,arguments);};}();var updateInfor=function updateInfor(){try{axios.patch('/user/update',{name:name?name:user.name,avatar:avatar?avatar:user.avatar},{headers:{Authorization:token}});setData(_objectSpread(_objectSpread({},data),{},{err:'',success:\"Updated Success!\"}));}catch(err){setData(_objectSpread(_objectSpread({},data),{},{err:err.response.data.msg,success:''}));}};var updatePassword=function updatePassword(){if(isLength(password))return setData(_objectSpread(_objectSpread({},data),{},{err:\"Password must be at least 6 characters.\",success:''}));if(!isMatch(password,cf_password))return setData(_objectSpread(_objectSpread({},data),{},{err:\"Password did not match.\",success:''}));try{axios.post('/user/reset',{password:password},{headers:{Authorization:token}});setData(_objectSpread(_objectSpread({},data),{},{err:'',success:\"Updated Success!\"}));}catch(err){setData(_objectSpread(_objectSpread({},data),{},{err:err.response.data.msg,success:''}));}};var handleUpdate=function handleUpdate(){if(name||avatar)updateInfor();if(password)updatePassword();};var handleDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!(user._id!==id)){_context2.next=8;break;}if(!window.confirm(\"Are you sure you want to delete this account?\")){_context2.next=8;break;}setLoading(true);_context2.next=6;return axios.delete(\"/user/delete/\".concat(id),{headers:{Authorization:token}});case 6:setLoading(false);setCallback(!callback);case 8:_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);setData(_objectSpread(_objectSpread({},data),{},{err:_context2.t0.response.data.msg,success:''}));case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function handleDelete(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",null,err&&showErrMsg(err),success&&showSuccessMsg(success),loading&&/*#__PURE__*/React.createElement(\"h3\",null,\"Loading.....\")),/*#__PURE__*/React.createElement(\"div\",{className:\"profile_page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-left\"},/*#__PURE__*/React.createElement(\"h2\",null,isAdmin?\"Admin Profile\":\"User Profile\"),/*#__PURE__*/React.createElement(\"div\",{className:\"avatar\"},/*#__PURE__*/React.createElement(\"img\",{src:avatar?avatar:user.avatar,alt:\"\"}),/*#__PURE__*/React.createElement(\"span\",null,/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-camera\"}),/*#__PURE__*/React.createElement(\"p\",null,\"Change\"),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",name:\"file\",id:\"file_up\",onChange:changeAvatar}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"name\"},\"Name\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"name\",id:\"name\",defaultValue:user.name,placeholder:\"Your name\",onChange:handleChange})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"email\"},\"Email\"),/*#__PURE__*/React.createElement(\"input\",{type:\"email\",name:\"email\",id:\"email\",defaultValue:user.email,placeholder:\"Your email address\",disabled:true})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"password\"},\"New Password\"),/*#__PURE__*/React.createElement(\"input\",{type:\"password\",name:\"password\",id:\"password\",placeholder:\"Your password\",value:password,onChange:handleChange})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"cf_password\"},\"Confirm New Password\"),/*#__PURE__*/React.createElement(\"input\",{type:\"password\",name:\"cf_password\",id:\"cf_password\",placeholder:\"Confirm password\",value:cf_password,onChange:handleChange})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"em\",{style:{color:\"crimson\"}},\"* If you update your password here, you will not be able to login quickly using google and facebook.\")),/*#__PURE__*/React.createElement(\"button\",{disabled:loading,onClick:handleUpdate},\"Update\")),/*#__PURE__*/React.createElement(\"div\",{className:\"col-right\"},/*#__PURE__*/React.createElement(\"h2\",null,isAdmin?\"Users\":\"My Orders\"),/*#__PURE__*/React.createElement(\"div\",{style:{overflowX:\"auto\"}},/*#__PURE__*/React.createElement(\"table\",{className:\"customers\"},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null,\"ID\"),/*#__PURE__*/React.createElement(\"th\",null,\"Name\"),/*#__PURE__*/React.createElement(\"th\",null,\"Email\"),/*#__PURE__*/React.createElement(\"th\",null,\"Admin\"),/*#__PURE__*/React.createElement(\"th\",null,\"Action\"))),/*#__PURE__*/React.createElement(\"tbody\",null,users.map(function(user){return/*#__PURE__*/React.createElement(\"tr\",{key:user._id},/*#__PURE__*/React.createElement(\"td\",null,user._id),/*#__PURE__*/React.createElement(\"td\",null,user.name),/*#__PURE__*/React.createElement(\"td\",null,user.email),/*#__PURE__*/React.createElement(\"td\",null,user.role===1?/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-check\",title:\"Admin\"}):/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-times\",title:\"User\"})),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Link,{to:\"/edit_user/\".concat(user._id)},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-edit\",title:\"Edit\"})),/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-trash-alt\",title:\"Remove\",onClick:function onClick(){return handleDelete(user._id);}})));})))))));}export default Profile;","map":{"version":3,"sources":["D:/gitzip/ReactwebHashcampus/client/src/components/body/profile/Profile.js"],"names":["React","useState","useEffect","axios","useSelector","useDispatch","Link","isLength","isMatch","showSuccessMsg","showErrMsg","fetchAllUsers","dispatchGetAllUsers","initialState","name","password","cf_password","err","success","Profile","auth","state","token","users","user","isAdmin","data","setData","avatar","setAvatar","loading","setLoading","callback","setCallback","dispatch","then","res","handleChange","e","target","value","changeAvatar","preventDefault","file","files","size","type","formData","FormData","append","post","headers","Authorization","url","response","msg","updateInfor","patch","updatePassword","handleUpdate","handleDelete","id","_id","window","confirm","delete","email","color","overflowX","map","role"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\nimport axios from 'axios'\nimport {useSelector, useDispatch} from 'react-redux'\nimport {Link} from 'react-router-dom'\nimport {isLength, isMatch} from '../../utils/validation/Validation'\nimport {showSuccessMsg, showErrMsg} from '../../utils/notification/Notification'\nimport {fetchAllUsers, dispatchGetAllUsers} from '../../../redux/actions/usersAction'\n\nconst initialState = {\n    name: '',\n    password: '',\n    cf_password: '',\n    err: '',\n    success: ''\n}\n\nfunction Profile() {\n    const auth = useSelector(state => state.auth)\n    const token = useSelector(state => state.token)\n\n     const users = useSelector(state => state.users)\n\n    const {user, isAdmin} = auth\n    const [data, setData] = useState(initialState)\n    const {name, password, cf_password, err, success} = data\n\n    const [avatar, setAvatar] = useState(false)\n    const [loading, setLoading] = useState(false)\n    const [callback, setCallback] = useState(false)\n\n    const dispatch = useDispatch()\n\n    useEffect(() => {\n        if(isAdmin){\n            fetchAllUsers(token).then(res =>{\n                dispatch(dispatchGetAllUsers(res))\n            })\n        }\n    },[token, isAdmin, dispatch, callback])\n\n    const handleChange = e => {\n        const {name, value} = e.target\n        setData({...data, [name]:value, err:'', success: ''})\n    }\n\n    const changeAvatar = async(e) => {\n        e.preventDefault()\n        try {\n            const file = e.target.files[0]\n\n            if(!file) return setData({...data, err: \"No files were uploaded.\" , success: ''})\n\n            if(file.size > 1024 * 1024)\n                return setData({...data, err: \"Size too large.\" , success: ''})\n\n            if(file.type !== 'image/jpeg' && file.type !== 'image/png')\n                return setData({...data, err: \"File format is incorrect.\" , success: ''})\n\n            let formData =  new FormData()\n            formData.append('file', file)\n\n            setLoading(true)\n            const res = await axios.post('/api/upload_avatar', formData, {\n                headers: {'content-type': 'multipart/form-data', Authorization: token}\n            })\n\n            setLoading(false)\n            setAvatar(res.data.url)\n            \n        } catch (err) {\n            setData({...data, err: err.response.data.msg , success: ''})\n        }\n    }\n\n    const updateInfor = () => {\n        try {\n            axios.patch('/user/update', {\n                name: name ? name : user.name,\n                avatar: avatar ? avatar : user.avatar\n            },{\n                headers: {Authorization: token}\n            })\n\n            setData({...data, err: '' , success: \"Updated Success!\"})\n        } catch (err) {\n            setData({...data, err: err.response.data.msg , success: ''})\n        }\n    }\n\n    const updatePassword = () => {\n        if(isLength(password))\n            return setData({...data, err: \"Password must be at least 6 characters.\", success: ''})\n\n        if(!isMatch(password, cf_password))\n            return setData({...data, err: \"Password did not match.\", success: ''})\n\n        try {\n            axios.post('/user/reset', {password},{\n                headers: {Authorization: token}\n            })\n\n            setData({...data, err: '' , success: \"Updated Success!\"})\n        } catch (err) {\n            setData({...data, err: err.response.data.msg , success: ''})\n        }\n    }\n\n    const handleUpdate = () => {\n        if(name || avatar) updateInfor()\n        if(password) updatePassword()\n    }\n\n    const handleDelete = async (id) => {\n        try {\n            if(user._id !== id){\n                if(window.confirm(\"Are you sure you want to delete this account?\")){\n                    setLoading(true)\n                    await axios.delete(`/user/delete/${id}`, {\n                        headers: {Authorization: token}\n                    })\n                    setLoading(false)\n                    setCallback(!callback)\n                }\n            }\n            \n        } catch (err) {\n            setData({...data, err: err.response.data.msg , success: ''})\n        }\n    }\n\n    return (\n        <>\n        <div>\n            {err && showErrMsg(err)}\n            {success && showSuccessMsg(success)}\n            {loading && <h3>Loading.....</h3>}\n        </div>\n        <div className=\"profile_page\">\n            <div className=\"col-left\">\n                <h2>{isAdmin ? \"Admin Profile\": \"User Profile\"}</h2>\n\n                <div className=\"avatar\">\n                    <img src={avatar ? avatar : user.avatar} alt=\"\"/>\n                    <span>\n                        <i className=\"fas fa-camera\"></i>\n                        <p>Change</p>\n                        <input type=\"file\" name=\"file\" id=\"file_up\" onChange={changeAvatar} />\n                    </span>\n                </div>\n\n                <div className=\"form-group\">\n                    <label htmlFor=\"name\">Name</label>\n                    <input type=\"text\" name=\"name\" id=\"name\" defaultValue={user.name}\n                    placeholder=\"Your name\" onChange={handleChange} />\n                </div>\n\n                <div className=\"form-group\">\n                    <label htmlFor=\"email\">Email</label>\n                    <input type=\"email\" name=\"email\" id=\"email\" defaultValue={user.email}\n                    placeholder=\"Your email address\" disabled />\n                </div>\n\n                <div className=\"form-group\">\n                    <label htmlFor=\"password\">New Password</label>\n                    <input type=\"password\" name=\"password\" id=\"password\"\n                    placeholder=\"Your password\" value={password} onChange={handleChange} />\n                </div>\n\n                <div className=\"form-group\">\n                    <label htmlFor=\"cf_password\">Confirm New Password</label>\n                    <input type=\"password\" name=\"cf_password\" id=\"cf_password\"\n                    placeholder=\"Confirm password\" value={cf_password} onChange={handleChange} />\n                </div>\n\n                <div>\n                    <em style={{color: \"crimson\"}}> \n                    * If you update your password here, you will not be able \n                        to login quickly using google and facebook.\n                    </em>\n                </div>\n\n                <button disabled={loading} onClick={handleUpdate}>Update</button>\n            </div>\n\n            <div className=\"col-right\">\n                <h2>{isAdmin ? \"Users\" : \"My Orders\"}</h2>\n\n                <div style={{overflowX: \"auto\"}}>\n                    <table className=\"customers\">\n                        <thead>\n                            <tr>\n                                <th>ID</th>\n                                <th>Name</th>\n                                <th>Email</th>\n                                <th>Admin</th>\n                                <th>Action</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {\n                                users.map(user => (\n                                    <tr key={user._id}>\n                                        <td>{user._id}</td>\n                                        <td>{user.name}</td>\n                                        <td>{user.email}</td>\n                                        <td>\n                                            {\n                                                user.role === 1\n                                                ? <i className=\"fas fa-check\" title=\"Admin\"></i>\n                                                : <i className=\"fas fa-times\" title=\"User\"></i>\n                                            }\n                                        </td>\n                                        <td>\n                                            <Link to={`/edit_user/${user._id}`}>\n                                                <i className=\"fas fa-edit\" title=\"Edit\"></i>\n                                            </Link>\n                                            <i className=\"fas fa-trash-alt\" title=\"Remove\"\n                                            onClick={() => handleDelete(user._id)} ></i>\n                                        </td>\n                                    </tr>\n                                ))\n                            }\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n        </>\n    )\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}